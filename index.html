<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Sistema de Conciliação Financeira ESPARTANO 2 - Dark Executive">
  <title>Conciliação ESPARTANO</title>

  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  
  <!-- CSS -->
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="wrap">
   
    <header class="app-header">
      <div class="title">
        <div class="logo">ES</div>
        <div>
          <h1>Conciliação ESPARTANO</h1>
          <div class="subtitle">Painel de Conciliação</div>
        </div>
      </div>

      <div class="header-actions">
        <button title="Calculadoras" onclick="window.location.href='calculadoras.html'">
          <i class="fa-solid fa-calculator"></i> Calculadoras
        </button>

        <button title="Alternar Tema" onclick="alternarTema()" id="themeToggle">
          <i class="fa-solid fa-sun"></i>
        </button>
        <button title="Entrada de Dados Detalhada" onclick="window.location.href='data_entry.html'">
          <i class="fa-solid fa-table"></i> Cadastro
        </button>
        <button title="Exportar Excel" onclick="exportarExcel()">
          <i class="fa-solid fa-file-excel"></i> Exportar
        </button>
        <button title="Imprimir Conciliação" onclick="imprimirConciliacao()">
          <i class="fa-solid fa-print"></i> Imprimir
        </button>
        <button title="Gerar Link" onclick="gerarLink(event)">
          <i class="fa-solid fa-link"></i> Link
        </button>
        <button title="Salvar local" onclick="salvarLocal(event)">
          <i class="fa-solid fa-save"></i> Salvar
        </button>
        <button title="Zerar tudo" onclick="zerarTudo()" class="btn-danger">
          <i class="fa-solid fa-trash"></i> Zerar
        </button>
      </div>
    </header>

    <main>
      <section class="panel main-panel">
        <h2><i class="fa-solid fa-wallet"></i> Dados da Conciliação</h2>

        <input 
          type="text" 
          id="estadoNome" 
          placeholder="Digite o nome do Estado/Local" 
          class="input-estado"
        >

        <div class="panel sub-panel">
          <div class="grid-2col">
            <div>
              <label for="dataSaldoInicial">Data Saldo Inicial</label>
              <input type="date" id="dataSaldoInicial" onchange="atualizarResumo()">
            </div>
            <div>
              <label for="saldoInicial">Saldo Inicial (R$)</label>
              <input 
                type="number" 
                id="saldoInicial" 
                step="0.01" 
                value="0.00" 
                onchange="atualizarResumo()" 
                class="saldo-input"
              >
            </div>
          </div>
        </div>

        <div class="panel sub-panel">
          <h2><i class="fa-solid fa-retweet"></i> Renovações</h2>
          <table id="tabelaRenovacoes">
            <thead>
              <tr>
                <th style="width:40px">#</th>
                <th>Nome</th>
                <th style="width:170px">Valor (R$)</th>
                <th style="width:70px"></th>
              </tr>
            </thead>
            <tbody></tbody>
            <tfoot></tfoot>
          </table>

          <div class="btn-group">
            <button class="btn btn-add" onclick="adicionarRenovacao()">
              <i class="fa-solid fa-plus"></i> Adicionar
            </button>
            <button class="btn btn-paste" onclick="togglePasteArea('renovacao')">
              <i class="fa-solid fa-paste"></i> Colar em Lote
            </button>
          </div>

          <div id="pasteArea-renovacao" class="paste-container" style="display:none;">
            <label>Cole colunas (Nome[TAB]Valor) do Excel:</label>
            <textarea 
              id="pasteText-renovacao" 
              onpaste="handlePaste(event, 'renovacao')" 
              placeholder="Cole aqui os dados do Excel..."
            ></textarea>
            <div class="paste-actions">
              <button class="btn" onclick="togglePasteArea('renovacao')">Cancelar</button>
            </div>
          </div>
        </div>

        <div class="panel sub-panel">
          <h2><i class="fa-solid fa-user-plus"></i> *Novos Clientes*</h2>
          <table id="tabelaNovos">
            <thead>
              <tr>
                <th style="width:40px">#</th>
                <th>Nome</th>
                <th style="width:170px">Valor (R$)</th>
                <th style="width:70px"></th>
              </tr>
            </thead>
            <tbody></tbody>
            <tfoot></tfoot>
          </table>

          <div class="btn-group">
            <button class="btn btn-add" onclick="adicionarNovo()">
              <i class="fa-solid fa-plus"></i> Adicionar
            </button>
            <button class="btn btn-paste" onclick="togglePasteArea('novo')">
              <i class="fa-solid fa-paste"></i> Colar em Lote
            </button>
          </div>

          <div id="pasteArea-novo" class="paste-container" style="display:none;">
            <label>Cole colunas (Nome[TAB]Valor) do Excel:</label>
            <textarea 
              id="pasteText-novo" 
              onpaste="handlePaste(event, 'novo')" 
              placeholder="Cole aqui os dados do Excel..."
            ></textarea>
            <div class="paste-actions">
              <button class="btn" onclick="togglePasteArea('novo')">Cancelar</button>
            </div>
          </div>
        </div>

        <div class="panel sub-panel">
          <h2><i class="fa-solid fa-arrow-down"></i> Entradas Diversas</h2>
          <table id="tabelaEntradas">
            <thead>
              <tr>
                <th style="width:40px">#</th>
                <th>Descrição</th>
                <th style="width:170px">Valor (R$)</th>
                <th style="width:70px"></th>
              </tr>
            </thead>
            <tbody></tbody>
            <tfoot></tfoot>
          </table>

          <div class="btn-group">
            <button class="btn btn-add" onclick="adicionarEntrada()">
              <i class="fa-solid fa-plus"></i> Adicionar
            </button>
            <button class="btn btn-paste" onclick="togglePasteArea('entrada')">
              <i class="fa-solid fa-paste"></i> Colar em Lote
            </button>
          </div>

          <div id="pasteArea-entrada" class="paste-container" style="display:none;">
            <label>Cole colunas (Descrição[TAB]Valor) do Excel:</label>
            <textarea 
              id="pasteText-entrada" 
              onpaste="handlePaste(event, 'entrada')" 
              placeholder="Cole aqui os dados do Excel..."
            ></textarea>
            <div class="paste-actions">
              <button class="btn" onclick="togglePasteArea('entrada')">Cancelar</button>
            </div>
          </div>
        </div>

        <div class="panel sub-panel">
          <h2><i class="fa-solid fa-arrow-up"></i> Saídas Diversas</h2>
          <table id="tabelaSaidas">
            <thead>
              <tr>
                <th style="width:40px">#</th>
                <th>Descrição</th>
                <th style="width:170px">Valor (R$)</th>
                <th style="width:70px"></th>
              </tr>
            </thead>
            <tbody></tbody>
            <tfoot></tfoot>
          </table>

          <div class="btn-group">
            <button class="btn btn-add" onclick="adicionarSaida()">
              <i class="fa-solid fa-plus"></i> Adicionar
            </button>
            <button class="btn btn-paste" onclick="togglePasteArea('saida')">
              <i class="fa-solid fa-paste"></i> Colar em Lote
            </button>
          </div>

          <div id="pasteArea-saida" class="paste-container" style="display:none;">
            <label>Cole colunas (Descrição[TAB]Valor) do Excel:</label>
            <textarea 
              id="pasteText-saida" 
              onpaste="handlePaste(event, 'saida')" 
              placeholder="Cole aqui os dados do Excel..."
            ></textarea>
            <div class="paste-actions">
              <button class="btn" onclick="togglePasteArea('saida')">Cancelar</button>
            </div>
          </div>
        </div>

        <div class="panel sub-panel">
          <div class="grid-2col">
            <div>
              <label for="dataSaldoFinal">Data Saldo Final</label>
              <input type="date" id="dataSaldoFinal" onchange="atualizarResumo()">
            </div>
            <div>
              <label for="saldoFinal">Saldo Final em Conta (R$)</label>
              <input 
                type="number" 
                id="saldoFinal" 
                step="0.01" 
                value="0.00" 
                onchange="atualizarResumo()" 
                class="saldo-input"
              >
            </div>
          </div>
        </div>

        <div style="margin-top:18px;">
          <button class="btn btn-conciliacao" onclick="gerarConciliacao()">
            <i class="fa-solid fa-file-invoice-dollar"></i> Gerar Texto de Conciliação
          </button>
        </div>

        <div id="conciliacaoOutput" class="conciliacao-output"></div>

        <div id="linkContainer" class="link-container" style="display:none;">
          <label>Link gerado (compartilhável):</label>
          <div class="link-display">
            <code id="linkGerado"></code>
            <button class="btn btn-copy" onclick="copiarLink(event)">
              <i class="fa-solid fa-copy"></i> Copiar
            </button>
          </div>
        </div>
      </section>

      <aside class="side">
        <!-- Resumo vazio -->
        <div id="resumoEmpty" class="card">
          <h3><i class="fa-solid fa-chart-line"></i> Resumo</h3>
          <p style="color:var(--muted); font-size:0.9rem; margin-top:12px;">
            Preencha os dados para visualizar o resumo da conciliação.
          </p>
        </div>

        <div id="resumo" class="card" style="display:none;">
          <h3><i class="fa-solid fa-chart-line"></i> Resumo Financeiro</h3>
          
          <div class="resumo-item">
            <span>Saldo Inicial:</span>
            <strong id="resSaldoInicial">R$ 0,00</strong>
          </div>
          
          <div class="resumo-item">
            <span>(-) Renovações:</span>
            <strong id="resRenovacoes">R$ 0,00</strong>
          </div>
          
          <div class="resumo-item">
            <span>(-) Novos Clientes:</span>
            <strong id="resNovos">R$ 0,00</strong>
          </div>
          
          <div class="resumo-item">
            <span>(+) Entradas Diversas:</span>
            <strong id="resEntradas">R$ 0,00</strong>
          </div>
          
          <div class="resumo-item">
            <span>(-) Saídas Diversas:</span>
            <strong id="resSaidas">R$ 0,00</strong>
          </div>
          
          <hr style="border:none; border-top:1px solid var(--border); margin:12px 0;">
          
          <div class="resumo-item">
            <span>Saldo Final (<span id="dataFinalResumo">--/--/----</span>):</span>
            <strong id="resSaldoFinal">R$ 0,00</strong>
          </div>
          
          <div class="resumo-item" style="font-size:1.1rem; margin-top:8px;">
            <span>Diferença:</span>
            <strong id="resDiferenca">R$ 0,00</strong>
          </div>
        </div>

        <div id="graficoCard" class="card" style="display:none;">
          <h3><i class="fa-solid fa-chart-bar"></i> Visualização Gráfica</h3>
          
          <div class="grafico-container">
            <div class="grafico-item">
              <div class="grafico-label">
                <span>Saldo Inicial</span>
                <strong id="grafSaldoInicial">R$ 0,00</strong>
              </div>
              <div class="grafico-barra-container">
                <div id="barraSaldoInicial" class="grafico-barra barra-inicial" style="width: 0%;"></div>
              </div>
            </div>

            <div class="grafico-item">
              <div class="grafico-label">
                <span>(-) Renovações</span>
                <strong id="grafRenovacoes">R$ 0,00</strong>
              </div>
              <div class="grafico-barra-container">
                <div id="barraRenovacoes" class="grafico-barra barra-negativa" style="width: 0%;"></div>
              </div>
            </div>

            <div class="grafico-item">
              <div class="grafico-label">
                <span>(-) Novos Clientes</span>
                <strong id="grafNovos">R$ 0,00</strong>
              </div>
              <div class="grafico-barra-container">
                <div id="barraNovos" class="grafico-barra barra-negativa" style="width: 0%;"></div>
              </div>
            </div>

            <div class="grafico-item">
              <div class="grafico-label">
                <span>(+) Entradas Diversas</span>
                <strong id="grafEntradas">R$ 0,00</strong>
              </div>
              <div class="grafico-barra-container">
                <div id="barraEntradas" class="grafico-barra barra-positiva" style="width: 0%;"></div>
              </div>
            </div>

            <div class="grafico-item">
              <div class="grafico-label">
                <span>(-) Saídas Diversas</span>
                <strong id="grafSaidas">R$ 0,00</strong>
              </div>
              <div class="grafico-barra-container">
                <div id="barraSaidas" class="grafico-barra barra-negativa" style="width: 0%;"></div>
              </div>
            </div>

            <hr style="border:none; border-top:1px solid var(--border); margin:16px 0;">

            <div class="grafico-item">
              <div class="grafico-label">
                <span>Saldo Final</span>
                <strong id="grafSaldoFinal">R$ 0,00</strong>
              </div>
              <div class="grafico-barra-container">
                <div id="barraSaldoFinal" class="grafico-barra barra-final" style="width: 0%;"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <h3><i class="fa-solid fa-info-circle"></i> Sistema</h3>

          <div class="card" style="margin-bottom: 12px;">
            <h3><i class="fa-solid fa-calendar-days"></i> Gerar Tabela da Diária</h3>

            <div class="grid-2col" style="margin-bottom: 12px;">
              <div class="form-group">
                <label for="dataInicial_diaria">Data de Início</label>
                <input type="date" id="dataInicial_diaria">
              </div>
              <div class="form-group">
                <label for="valorDiaria">Valor Diária (R$)</label>
                <input type="text" id="valorDiaria" placeholder="Ex: 150,00">
              </div>
            </div>

            <button class="btn btn-add" onclick="gerarTabelaDiaria()" style="width: 100%; margin-bottom: 12px;">
              <i class="fa-solid fa-table"></i> Gerar Tabela
            </button>

            <div id="resultadoDiaria" class="resultado-diaria">
              <!-- Tabela de diárias será inserida aqui -->
            </div>

            <button class="btn btn-copy" id="btnCopiarDiaria" onclick="copiarTabelaDiaria()" style="margin-top: 12px; width: 100%;">
              <i class="fa-solid fa-copy"></i> Copiar Tabela
            </button>
          </div>

          <div class="resumo-item">
            <span>Data:</span>
            <strong id="dataAtual">--/--/----</strong>
          </div>
          <div class="resumo-item">
            <span>Hora:</span>
            <strong id="horaAtual">--:--:--</strong>
          </div>
          <div style="margin-top:12px; color:var(--muted); font-size:0.85rem;">
            <i class="fa-solid fa-circle-check"></i> <span id="status">Sistema Pronto</span>
          </div>
          
          <div style="margin-top: 15px;">
            <button class="btn btn-conciliacao" onclick="salvarNoBanco()" style="width: 100%; padding: 8px 12px; font-size: 0.9rem;">
              <i class="fa-solid fa-cloud-arrow-up"></i> SALVAR NO BANCO (PDF)
            </button>
          </div>
        </div>
      </aside>
    </main>

    <footer class="footer">
      <div>
        <strong>ESPARTANO</strong> — Sistema de Conciliação Financeira
      </div>
      <div>
        Prototipo <i class="fa-solid fa-heart" style="color:#0026ff;"></i> 
      </div>
    </footer>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://unpkg.com/vanilla-masker@1.1.1/build/vanilla-masker.min.js"></script>
  
  <script src="login.js"></script>
  <script src="script.js"></script>
  <script src="gerar_diaria.js"></script>
  <script>
    // Verifica permissão ao carregar
    checkPermission(['conciliacao', 'admin']);
  </script>
</body>
</html>